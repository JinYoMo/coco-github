{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _Row from \"antd/lib/row\";\nimport _Pagination from \"antd/lib/pagination\";\nimport _Col from \"antd/lib/col\";\nimport _List from \"antd/lib/list\";\nimport _extends from \"@babel/runtime-corejs2/helpers/esm/extends\";\nimport _JSXStyle from \"styled-jsx/style\";\nimport React from \"react\";\nimport { memo, isValidElement, useEffect } from 'react';\nimport { withRouter } from 'next/router';\n//栅格\nimport Link from 'next/link';\nimport Router from 'next/router';\nimport Repo from '../components/Repo';\nimport { cacheArray } from '../lib/repo-basic-cache';\nimport api from '../lib/api'; //搜索条件\n\nvar LANGUAGE = ['JavaScript', 'HTML', 'CSS', 'TypeScript', 'Java', 'Rust'];\nvar SORT_TYPES = [{\n  name: 'Best Match'\n}, {\n  name: 'Most Stars',\n  value: 'stars',\n  order: 'desc'\n}, {\n  name: 'Fewest Stars',\n  value: 'stars',\n  order: 'asc'\n}, {\n  name: 'Most Forks',\n  value: 'forks',\n  order: 'desc'\n}, {\n  name: 'Fewest Forks',\n  value: 'forks',\n  order: 'asc'\n}];\n/**\r\n * sort：排序方式\r\n * order：排序顺序（升/降序）\r\n * lang：仓库的项目开发主语言\r\n * page：分页页面\r\n */\n\nvar selectedItemStyle = {\n  borderLeft: '2px solid #e36209',\n  fontWeight: 100\n};\n\nfunction noop() {}\n\nvar per_page = 20;\nvar isServer = typeof window === 'undefined'; //memo方法作用：name,query,lang,sort,order 这些参数无变化，则不会被重新渲染\n\nvar FilterLink = memo(function (_ref) {\n  var name = _ref.name,\n      query = _ref.query,\n      lang = _ref.lang,\n      sort = _ref.sort,\n      order = _ref.order,\n      page = _ref.page;\n  var queryString = \"?query=\".concat(query);\n  if (lang) queryString += \"&lang=\".concat(lang);\n  if (sort) queryString += \"&sort=\".concat(sort, \"&order=\").concat(order || 'desc');\n  if (page) queryString += \"&page=\".concat(page);\n  queryString += \"&per_page=\".concat(per_page);\n  return /*#__PURE__*/React.createElement(Link, {\n    href: \"/search\".concat(queryString)\n  }, isValidElement(name) ? name : /*#__PURE__*/React.createElement(\"a\", null, name));\n});\n\nfunction Search(_ref2) {\n  var router = _ref2.router,\n      repos = _ref2.repos;\n  console.log(repos); // const {sort,order,lang,query}=router.query\n\n  var querys = _extends({}, router.query);\n\n  var _router$query = router.query,\n      sort = _router$query.sort,\n      order = _router$query.order,\n      lang = _router$query.lang,\n      page = _router$query.page; //每次调用存储数据\n\n  useEffect(function () {\n    //客户端情况下保存\n    if (!isServer) cacheArray(repos.items);\n  });\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"jsx-3134128888\" + \" \" + \"root\"\n  }, /*#__PURE__*/React.createElement(_Row, {\n    gutter: 20\n  }, /*#__PURE__*/React.createElement(_Col, {\n    span: 6\n  }, /*#__PURE__*/React.createElement(_List, {\n    bordered: true,\n    header: /*#__PURE__*/React.createElement(\"span\", {\n      className: \"jsx-3134128888\" + \" \" + \"list-header\"\n    }, \"\\u8BED\\u8A00\"),\n    style: {\n      marginBottom: 20\n    },\n    dataSource: LANGUAGE,\n    renderItem: function renderItem(item) {\n      var selected = lang === item;\n      return /*#__PURE__*/React.createElement(_List.Item, {\n        style: selected ? selectedItemStyle : null\n      }, selected ? /*#__PURE__*/React.createElement(\"span\", {\n        className: \"jsx-3134128888\"\n      }, item) : /*#__PURE__*/React.createElement(FilterLink, _extends({}, querys, {\n        lang: item,\n        name: item\n      })));\n    }\n  }), /*#__PURE__*/React.createElement(_List, {\n    bordered: true,\n    header: /*#__PURE__*/React.createElement(\"span\", {\n      className: \"jsx-3134128888\" + \" \" + \"list-header\"\n    }, \"\\u6392\\u5E8F\"),\n    dataSource: SORT_TYPES,\n    renderItem: function renderItem(item) {\n      var selected = false;\n\n      if (item.name === 'Best Match' && !sort) {\n        selected = true;\n      } else if (item.value === sort && item.order === order) {\n        selected = true;\n      }\n\n      return /*#__PURE__*/React.createElement(_List.Item, {\n        style: selected ? selectedItemStyle : null\n      }, selected ? /*#__PURE__*/React.createElement(\"span\", {\n        className: \"jsx-3134128888\"\n      }, item.name) : /*#__PURE__*/React.createElement(FilterLink, _extends({}, querys, {\n        sort: item.value,\n        order: item.order,\n        name: item.name\n      })));\n    }\n  })), /*#__PURE__*/React.createElement(_Col, {\n    span: 18\n  }, /*#__PURE__*/React.createElement(\"h3\", {\n    className: \"jsx-3134128888\" + \" \" + \"repos-title\"\n  }, repos.total_count, \" \\u4E2A\\u4ED3\\u5E93\"), repos.items.map(function (repo) {\n    return /*#__PURE__*/React.createElement(Repo, {\n      repo: repo,\n      key: repo.id\n    });\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"jsx-3134128888\" + \" \" + \"pagination\"\n  }, /*#__PURE__*/React.createElement(_Pagination, {\n    pageSize: per_page,\n    current: Number(page) || 1,\n    total: 1000,\n    onChange: noop,\n    itemRender: function itemRender(page, type, ol) {\n      var p = type === 'page' ? page : type === 'prev' ? page - 1 : page + 1;\n      var name = type === 'page' ? page : ol;\n      return /*#__PURE__*/React.createElement(FilterLink, _extends({}, querys, {\n        page: p,\n        name: name\n      }));\n    }\n  })))), /*#__PURE__*/React.createElement(_JSXStyle, {\n    id: \"3134128888\"\n  }, [\".root.jsx-3134128888{padding:20px 0;}\", \".list-header.jsx-3134128888{font-weight:800;font-size:16px;}\", \".repos-title.jsx-3134128888{border-bottom:1px solid #eee;font-size:24px;line-height:50px;}\", \".pagination.jsx-3134128888{padding:20px;text-align:center;}\"]));\n}\n\nSearch.getInitialProps = /*#__PURE__*/function () {\n  var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref3) {\n    var ctx, _ctx$query, query, sort, order, lang, page, queryString, result;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            ctx = _ref3.ctx;\n            _ctx$query = ctx.query, query = _ctx$query.query, sort = _ctx$query.sort, order = _ctx$query.order, lang = _ctx$query.lang, page = _ctx$query.page;\n\n            if (query) {\n              _context.next = 4;\n              break;\n            }\n\n            return _context.abrupt(\"return\", {\n              repos: {\n                total_count: 0\n              }\n            });\n\n          case 4:\n            //?q=react+language:javascript&sort=stars&order=desc&page=2\n            queryString = \"?q=\".concat(query);\n            if (lang) queryString += \"+language:\".concat(lang);\n            if (sort) queryString += \"&sort=\".concat(sort, \"&order=\").concat(order || 'desc');\n            if (page) queryString += \"&page=\".concat(page);\n            queryString += \"&per_page=\".concat(per_page); //调用搜索列表接口\n\n            _context.next = 11;\n            return api.request({\n              url: \"/search/repositories\".concat(queryString)\n            }, ctx.req, ctx.res);\n\n          case 11:\n            result = _context.sent;\n            return _context.abrupt(\"return\", {\n              repos: result.data\n            });\n\n          case 13:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function (_x) {\n    return _ref4.apply(this, arguments);\n  };\n}();\n\nexport default withRouter(Search);","map":null,"metadata":{},"sourceType":"module"}