{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _Row from \"antd/lib/row\";\nimport _Pagination from \"antd/lib/pagination\";\nimport _Col from \"antd/lib/col\";\nimport _List from \"antd/lib/list\";\nimport _extends from \"@babel/runtime-corejs2/helpers/esm/extends\";\nimport _JSXStyle from \"styled-jsx/style\";\nimport React from \"react\";\nimport { memo, isValidElement, useEffect } from 'react';\nimport { withRouter } from 'next/router';\n//栅格\nimport Link from 'next/link';\nimport Router from 'next/router';\nimport Repo from '../components/Repo';\nimport { cacheArray } from '../lib/repo-basic-cache';\nimport api from '../lib/api'; //搜索条件\n\nvar LANGUAGE = ['JavaScript', 'HTML', 'CSS', 'TypeScript', 'Java', 'Rust'];\nvar SORT_TYPES = [{\n  name: 'Best Match'\n}, {\n  name: 'Most Stars',\n  value: 'stars',\n  order: 'desc'\n}, {\n  name: 'Fewest Stars',\n  value: 'stars',\n  order: 'asc'\n}, {\n  name: 'Most Forks',\n  value: 'forks',\n  order: 'desc'\n}, {\n  name: 'Fewest Forks',\n  value: 'forks',\n  order: 'asc'\n}];\n/**\r\n * sort：排序方式\r\n * order：排序顺序（升/降序）\r\n * lang：仓库的项目开发主语言\r\n * page：分页页面\r\n */\n\nvar selectedItemStyle = {\n  borderLeft: '2px solid #e36209',\n  fontWeight: 100\n};\n\nfunction noop() {}\n\nvar per_page = 20; //memo方法作用：name,query,lang,sort,order 这些参数无变化，则不会被重新渲染\n\nvar FilterLink = memo(function (_ref) {\n  var name = _ref.name,\n      query = _ref.query,\n      lang = _ref.lang,\n      sort = _ref.sort,\n      order = _ref.order,\n      page = _ref.page;\n  var queryString = \"?query=\".concat(query);\n  if (lang) queryString += \"&lang=\".concat(lang);\n  if (sort) queryString += \"&sort=\".concat(sort, \"&order=\").concat(order || 'desc');\n  if (page) queryString += \"&page=\".concat(page);\n  queryString += \"&per_page=\".concat(per_page);\n  return /*#__PURE__*/React.createElement(Link, {\n    href: \"/search\".concat(queryString)\n  }, isValidElement(name) ? name : /*#__PURE__*/React.createElement(\"a\", null, name));\n});\n\nfunction Search(_ref2) {\n  var router = _ref2.router,\n      repos = _ref2.repos;\n  console.log(repos); // const {sort,order,lang,query}=router.query\n\n  var querys = _extends({}, router.query);\n\n  var _router$query = router.query,\n      sort = _router$query.sort,\n      order = _router$query.order,\n      lang = _router$query.lang,\n      page = _router$query.page; //每次调用存储数据\n\n  useEffect(function () {\n    cacheArray(repos.items);\n  });\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"jsx-3134128888\" + \" \" + \"root\"\n  }, /*#__PURE__*/React.createElement(_Row, {\n    gutter: 20\n  }, /*#__PURE__*/React.createElement(_Col, {\n    span: 6\n  }, /*#__PURE__*/React.createElement(_List, {\n    bordered: true,\n    header: /*#__PURE__*/React.createElement(\"span\", {\n      className: \"jsx-3134128888\" + \" \" + \"list-header\"\n    }, \"\\u8BED\\u8A00\"),\n    style: {\n      marginBottom: 20\n    },\n    dataSource: LANGUAGE,\n    renderItem: function renderItem(item) {\n      var selected = lang === item;\n      return /*#__PURE__*/React.createElement(_List.Item, {\n        style: selected ? selectedItemStyle : null\n      }, selected ? /*#__PURE__*/React.createElement(\"span\", {\n        className: \"jsx-3134128888\"\n      }, item) : /*#__PURE__*/React.createElement(FilterLink, _extends({}, querys, {\n        lang: item,\n        name: item\n      })));\n    }\n  }), /*#__PURE__*/React.createElement(_List, {\n    bordered: true,\n    header: /*#__PURE__*/React.createElement(\"span\", {\n      className: \"jsx-3134128888\" + \" \" + \"list-header\"\n    }, \"\\u6392\\u5E8F\"),\n    dataSource: SORT_TYPES,\n    renderItem: function renderItem(item) {\n      var selected = false;\n\n      if (item.name === 'Best Match' && !sort) {\n        selected = true;\n      } else if (item.value === sort && item.order === order) {\n        selected = true;\n      }\n\n      return /*#__PURE__*/React.createElement(_List.Item, {\n        style: selected ? selectedItemStyle : null\n      }, selected ? /*#__PURE__*/React.createElement(\"span\", {\n        className: \"jsx-3134128888\"\n      }, item.name) : /*#__PURE__*/React.createElement(FilterLink, _extends({}, querys, {\n        sort: item.value,\n        order: item.order,\n        name: item.name\n      })));\n    }\n  })), /*#__PURE__*/React.createElement(_Col, {\n    span: 18\n  }, /*#__PURE__*/React.createElement(\"h3\", {\n    className: \"jsx-3134128888\" + \" \" + \"repos-title\"\n  }, repos.total_count, \" \\u4E2A\\u4ED3\\u5E93\"), repos.items.map(function (repo) {\n    return /*#__PURE__*/React.createElement(Repo, {\n      repo: repo,\n      key: repo.id\n    });\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"jsx-3134128888\" + \" \" + \"pagination\"\n  }, /*#__PURE__*/React.createElement(_Pagination, {\n    pageSize: per_page,\n    current: Number(page) || 1,\n    total: 1000,\n    onChange: noop,\n    itemRender: function itemRender(page, type, ol) {\n      var p = type === 'page' ? page : type === 'prev' ? page - 1 : page + 1;\n      var name = type === 'page' ? page : ol;\n      return /*#__PURE__*/React.createElement(FilterLink, _extends({}, querys, {\n        page: p,\n        name: name\n      }));\n    }\n  })))), /*#__PURE__*/React.createElement(_JSXStyle, {\n    id: \"3134128888\"\n  }, \".root.jsx-3134128888{padding:20px 0;}.list-header.jsx-3134128888{font-weight:800;font-size:16px;}.repos-title.jsx-3134128888{border-bottom:1px solid #eee;font-size:24px;line-height:50px;}.pagination.jsx-3134128888{padding:20px;text-align:center;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkU6XFzkuKrkurrpobnnm65cXGdpdEh1YumhueebrlxcY29jby1naXRodWJcXHBhZ2VzXFxzZWFyY2guanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBc0lrQixBQUd5QixBQUdDLEFBSWEsQUFLaEIsYUFDSyxFQVpuQixDQUdnQixhQUlBLEVBSGhCLEFBU0EsYUFMa0IsaUJBQ2xCIiwiZmlsZSI6IkU6XFzkuKrkurrpobnnm65cXGdpdEh1YumhueebrlxcY29jby1naXRodWJcXHBhZ2VzXFxzZWFyY2guanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge21lbW8saXNWYWxpZEVsZW1lbnQsdXNlRWZmZWN0fSBmcm9tICdyZWFjdCdcclxuaW1wb3J0IHt3aXRoUm91dGVyfSBmcm9tICduZXh0L3JvdXRlcidcclxuaW1wb3J0IHtSb3csQ29sLExpc3QsUGFnaW5hdGlvbn0gZnJvbSAnYW50ZCcgIC8v5qCF5qC8XHJcbmltcG9ydCBMaW5rIGZyb20gJ25leHQvbGluaydcclxuaW1wb3J0IFJvdXRlciBmcm9tICduZXh0L3JvdXRlcidcclxuXHJcbmltcG9ydCBSZXBvIGZyb20gJy4uL2NvbXBvbmVudHMvUmVwbydcclxuaW1wb3J0IHtjYWNoZUFycmF5fSBmcm9tICcuLi9saWIvcmVwby1iYXNpYy1jYWNoZSdcclxuXHJcbmltcG9ydCBhcGkgZnJvbSAnLi4vbGliL2FwaSdcclxuXHJcbi8v5pCc57Si5p2h5Lu2XHJcbmNvbnN0IExBTkdVQUdFPVsnSmF2YVNjcmlwdCcsJ0hUTUwnLCdDU1MnLCdUeXBlU2NyaXB0JywnSmF2YScsJ1J1c3QnXVxyXG5jb25zdCBTT1JUX1RZUEVTPVtcclxuICB7XHJcbiAgICBuYW1lOidCZXN0IE1hdGNoJ1xyXG4gIH0sXHJcbiAge1xyXG4gICAgbmFtZTonTW9zdCBTdGFycycsXHJcbiAgICB2YWx1ZTonc3RhcnMnLFxyXG4gICAgb3JkZXI6J2Rlc2MnXHJcbiAgfSxcclxuICB7XHJcbiAgICBuYW1lOidGZXdlc3QgU3RhcnMnLFxyXG4gICAgdmFsdWU6J3N0YXJzJyxcclxuICAgIG9yZGVyOidhc2MnXHJcbiAgfSxcclxuICB7XHJcbiAgICBuYW1lOidNb3N0IEZvcmtzJyxcclxuICAgIHZhbHVlOidmb3JrcycsXHJcbiAgICBvcmRlcjonZGVzYydcclxuICB9LFxyXG4gIHtcclxuICAgIG5hbWU6J0Zld2VzdCBGb3JrcycsXHJcbiAgICB2YWx1ZTonZm9ya3MnLFxyXG4gICAgb3JkZXI6J2FzYydcclxuICB9LFxyXG5dXHJcblxyXG4vKipcclxuICogc29ydO+8muaOkuW6j+aWueW8j1xyXG4gKiBvcmRlcu+8muaOkuW6j+mhuuW6j++8iOWNhy/pmY3luo/vvIlcclxuICogbGFuZ++8muS7k+W6k+eahOmhueebruW8gOWPkeS4u+ivreiogFxyXG4gKiBwYWdl77ya5YiG6aG16aG16Z2iXHJcbiAqL1xyXG5cclxuIGNvbnN0IHNlbGVjdGVkSXRlbVN0eWxlPXtcclxuICAgYm9yZGVyTGVmdDonMnB4IHNvbGlkICNlMzYyMDknLFxyXG4gICBmb250V2VpZ2h0OjEwMFxyXG4gfVxyXG4gZnVuY3Rpb24gbm9vcCgpe31cclxuXHJcbiBjb25zdCBwZXJfcGFnZT0yMFxyXG4vL21lbW/mlrnms5XkvZznlKjvvJpuYW1lLHF1ZXJ5LGxhbmcsc29ydCxvcmRlciDov5nkupvlj4LmlbDml6Dlj5jljJbvvIzliJnkuI3kvJrooqvph43mlrDmuLLmn5NcclxuIGNvbnN0IEZpbHRlckxpbms9bWVtbygoe25hbWUscXVlcnksbGFuZyxzb3J0LG9yZGVyLHBhZ2V9KT0+e1xyXG4gICAgbGV0IHF1ZXJ5U3RyaW5nPWA/cXVlcnk9JHtxdWVyeX1gXHJcbiAgICBpZihsYW5nKSBxdWVyeVN0cmluZys9YCZsYW5nPSR7bGFuZ31gXHJcbiAgICBpZihzb3J0KSBxdWVyeVN0cmluZys9YCZzb3J0PSR7c29ydH0mb3JkZXI9JHtvcmRlcnx8J2Rlc2MnfWBcclxuICAgIGlmKHBhZ2UpIHF1ZXJ5U3RyaW5nKz1gJnBhZ2U9JHtwYWdlfWBcclxuICAgIHF1ZXJ5U3RyaW5nKz1gJnBlcl9wYWdlPSR7cGVyX3BhZ2V9YFxyXG5cclxuICAgIHJldHVybiA8TGluayBocmVmPXtgL3NlYXJjaCR7cXVlcnlTdHJpbmd9YH0+XHJcbiAgICAgIHtpc1ZhbGlkRWxlbWVudChuYW1lKT9uYW1lOjxhPntuYW1lfTwvYT59XHJcbiAgICA8L0xpbms+XHJcbiB9KVxyXG5mdW5jdGlvbiBTZWFyY2goe3JvdXRlcixyZXBvc30pe1xyXG4gIGNvbnNvbGUubG9nKHJlcG9zKVxyXG4gIFxyXG4gIC8vIGNvbnN0IHtzb3J0LG9yZGVyLGxhbmcscXVlcnl9PXJvdXRlci5xdWVyeVxyXG4gIGNvbnN0IHsuLi5xdWVyeXN9PXJvdXRlci5xdWVyeVxyXG4gIGNvbnN0IHtzb3J0LG9yZGVyLGxhbmcscGFnZX09cm91dGVyLnF1ZXJ5XHJcbiAgLy/mr4/mrKHosIPnlKjlrZjlgqjmlbDmja5cclxuICB1c2VFZmZlY3QoKCk9PntcclxuICAgIGNhY2hlQXJyYXkocmVwb3MuaXRlbXMpXHJcbiAgfSlcclxuXHJcbiAgcmV0dXJuIChcclxuICAgIDxkaXYgY2xhc3NOYW1lPVwicm9vdFwiPlxyXG4gICAgICA8Um93IGd1dHRlcj17MjB9PlxyXG4gICAgICAgIDxDb2wgc3Bhbj17Nn0+XHJcbiAgICAgICAgICAgPExpc3QgXHJcbiAgICAgICAgICAgICBib3JkZXJlZFxyXG4gICAgICAgICAgICAgaGVhZGVyPXs8c3BhbiBjbGFzc05hbWU9XCJsaXN0LWhlYWRlclwiPuivreiogDwvc3Bhbj59XHJcbiAgICAgICAgICAgICBzdHlsZT17e21hcmdpbkJvdHRvbToyMH19XHJcbiAgICAgICAgICAgICBkYXRhU291cmNlPXtMQU5HVUFHRX1cclxuICAgICAgICAgICAgIHJlbmRlckl0ZW09e2l0ZW09PntcclxuICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWQ9bGFuZz09PWl0ZW1cclxuICAgICAgICAgICAgICAgcmV0dXJuIChcclxuICAgICAgICAgICAgICAgICA8TGlzdC5JdGVtIHN0eWxlPXtzZWxlY3RlZD9zZWxlY3RlZEl0ZW1TdHlsZTpudWxsfT5cclxuICAgICAgICAgICAgICAgICAgIHtzZWxlY3RlZD88c3Bhbj57aXRlbX08L3NwYW4+OjxGaWx0ZXJMaW5rIHsuLi5xdWVyeXN9IGxhbmc9e2l0ZW19IG5hbWU9e2l0ZW19Lz59XHJcbiAgICAgICAgICAgICAgICAgPC9MaXN0Lkl0ZW0+XHJcbiAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgIH19XHJcbiAgICAgICAgICAgLz5cclxuICAgICAgICAgICAgPExpc3QgXHJcbiAgICAgICAgICAgICBib3JkZXJlZFxyXG4gICAgICAgICAgICAgaGVhZGVyPXs8c3BhbiBjbGFzc05hbWU9XCJsaXN0LWhlYWRlclwiPuaOkuW6jzwvc3Bhbj59XHJcbiAgICAgICAgICAgICBkYXRhU291cmNlPXtTT1JUX1RZUEVTfVxyXG4gICAgICAgICAgICAgcmVuZGVySXRlbT17aXRlbT0+e1xyXG4gICAgICAgICAgICAgICBsZXQgc2VsZWN0ZWQ9ZmFsc2VcclxuICAgICAgICAgICAgICAgaWYoaXRlbS5uYW1lPT09J0Jlc3QgTWF0Y2gnJiYhc29ydCl7XHJcbiAgICAgICAgICAgICAgICAgc2VsZWN0ZWQ9dHJ1ZVxyXG4gICAgICAgICAgICAgICB9ZWxzZSBpZihpdGVtLnZhbHVlPT09c29ydCYmaXRlbS5vcmRlcj09PW9yZGVyKXtcclxuICAgICAgICAgICAgICAgICBzZWxlY3RlZD10cnVlXHJcbiAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgcmV0dXJuIChcclxuICAgICAgICAgICAgICAgIDxMaXN0Lkl0ZW0gc3R5bGU9e3NlbGVjdGVkP3NlbGVjdGVkSXRlbVN0eWxlOm51bGx9PlxyXG4gICAgICAgICAgICAgICAgICB7c2VsZWN0ZWQ/PHNwYW4+e2l0ZW0ubmFtZX08L3NwYW4+OjxGaWx0ZXJMaW5rIHsuLi5xdWVyeXN9IHNvcnQ9e2l0ZW0udmFsdWV9IG9yZGVyPXtpdGVtLm9yZGVyfSBuYW1lPXtpdGVtLm5hbWV9Lz59XHJcbiAgICAgICAgICAgICAgICAgPC9MaXN0Lkl0ZW0+XHJcbiAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgIH19XHJcbiAgICAgICAgICAgLz5cclxuICAgICAgICA8L0NvbD5cclxuICAgICAgICA8Q29sIHNwYW49ezE4fT5cclxuICAgICAgICAgICAgPGgzIGNsYXNzTmFtZT1cInJlcG9zLXRpdGxlXCI+e3JlcG9zLnRvdGFsX2NvdW50fSDkuKrku5PlupM8L2gzPlxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgcmVwb3MuaXRlbXMubWFwKHJlcG8gPT4gPFJlcG8gcmVwbz17cmVwb30ga2V5PXtyZXBvLmlkfSAvPilcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInBhZ2luYXRpb25cIj5cclxuICAgICAgICAgICAgICA8UGFnaW5hdGlvblxyXG4gICAgICAgICAgICAgICAgcGFnZVNpemU9e3Blcl9wYWdlfVxyXG4gICAgICAgICAgICAgICAgY3VycmVudD17TnVtYmVyKHBhZ2UpIHx8IDF9XHJcbiAgICAgICAgICAgICAgICB0b3RhbD17MTAwMH1cclxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXtub29wfVxyXG4gICAgICAgICAgICAgICAgaXRlbVJlbmRlcj17KHBhZ2UsIHR5cGUsIG9sKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPVxyXG4gICAgICAgICAgICAgICAgICAgIHR5cGUgPT09ICdwYWdlJyA/IHBhZ2UgOiB0eXBlID09PSAncHJldicgPyBwYWdlIC0gMSA6IHBhZ2UgKyAxXHJcbiAgICAgICAgICAgICAgICAgIGNvbnN0IG5hbWUgPSB0eXBlID09PSAncGFnZScgPyBwYWdlIDogb2xcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIDxGaWx0ZXJMaW5rIHsuLi5xdWVyeXN9IHBhZ2U9e3B9IG5hbWU9e25hbWV9IC8+XHJcbiAgICAgICAgICAgICAgICB9fVxyXG4gICAgICAgICAgICAgIC8+XHJcbiAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICA8L0NvbD5cclxuICAgICAgPC9Sb3c+XHJcbiAgICAgIDxzdHlsZSBqc3g+e2BcclxuICAgICAgICAucm9vdHtcclxuICAgICAgICAgIHBhZGRpbmc6MjBweCAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICAubGlzdC1oZWFkZXJ7XHJcbiAgICAgICAgICBmb250LXdlaWdodDo4MDA7XHJcbiAgICAgICAgICBmb250LXNpemU6MTZweDtcclxuICAgICAgICB9XHJcbiAgICAgICAgLnJlcG9zLXRpdGxle1xyXG4gICAgICAgICAgYm9yZGVyLWJvdHRvbToxcHggc29saWQgI2VlZTtcclxuICAgICAgICAgIGZvbnQtc2l6ZToyNHB4O1xyXG4gICAgICAgICAgbGluZS1oZWlnaHQ6NTBweDtcclxuICAgICAgICB9XHJcbiAgICAgICAgLnBhZ2luYXRpb257XHJcbiAgICAgICAgICBwYWRkaW5nOjIwcHg7XHJcbiAgICAgICAgICB0ZXh0LWFsaWduOmNlbnRlcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgYH08L3N0eWxlPlxyXG4gICAgPC9kaXY+XHJcbiAgKVxyXG4gIFxyXG59XHJcblxyXG5TZWFyY2guZ2V0SW5pdGlhbFByb3BzPWFzeW5jICh7Y3R4fSk9PntcclxuICBjb25zdCB7cXVlcnksc29ydCxvcmRlcixsYW5nLHBhZ2V9PWN0eC5xdWVyeTtcclxuICBpZighcXVlcnkpe1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgcmVwb3M6e1xyXG4gICAgICAgIHRvdGFsX2NvdW50OjBcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICAvLz9xPXJlYWN0K2xhbmd1YWdlOmphdmFzY3JpcHQmc29ydD1zdGFycyZvcmRlcj1kZXNjJnBhZ2U9MlxyXG4gIGxldCBxdWVyeVN0cmluZz1gP3E9JHtxdWVyeX1gXHJcbiAgaWYobGFuZykgcXVlcnlTdHJpbmcrPWArbGFuZ3VhZ2U6JHtsYW5nfWBcclxuICBpZihzb3J0KSBxdWVyeVN0cmluZys9YCZzb3J0PSR7c29ydH0mb3JkZXI9JHtvcmRlcnx8J2Rlc2MnfWBcclxuICBpZihwYWdlKSBxdWVyeVN0cmluZys9YCZwYWdlPSR7cGFnZX1gXHJcbiAgcXVlcnlTdHJpbmcrPWAmcGVyX3BhZ2U9JHtwZXJfcGFnZX1gXHJcbiAgLy/osIPnlKjmkJzntKLliJfooajmjqXlj6NcclxuICBjb25zdCByZXN1bHQ9YXdhaXQgYXBpLnJlcXVlc3Qoe1xyXG4gICAgdXJsOmAvc2VhcmNoL3JlcG9zaXRvcmllcyR7cXVlcnlTdHJpbmd9YFxyXG4gIH0sY3R4LnJlcSxjdHgucmVzKVxyXG5cclxuICByZXR1cm4ge1xyXG4gICAgcmVwb3M6cmVzdWx0LmRhdGFcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IHdpdGhSb3V0ZXIoU2VhcmNoKSJdfQ== */\\n/*@ sourceURL=E:\\\\\\u4E2A\\u4EBA\\u9879\\u76EE\\\\gitHub\\u9879\\u76EE\\\\coco-github\\\\pages\\\\search.js */\"));\n}\n\nSearch.getInitialProps = /*#__PURE__*/function () {\n  var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref3) {\n    var ctx, _ctx$query, query, sort, order, lang, page, queryString, result;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            ctx = _ref3.ctx;\n            _ctx$query = ctx.query, query = _ctx$query.query, sort = _ctx$query.sort, order = _ctx$query.order, lang = _ctx$query.lang, page = _ctx$query.page;\n\n            if (query) {\n              _context.next = 4;\n              break;\n            }\n\n            return _context.abrupt(\"return\", {\n              repos: {\n                total_count: 0\n              }\n            });\n\n          case 4:\n            //?q=react+language:javascript&sort=stars&order=desc&page=2\n            queryString = \"?q=\".concat(query);\n            if (lang) queryString += \"+language:\".concat(lang);\n            if (sort) queryString += \"&sort=\".concat(sort, \"&order=\").concat(order || 'desc');\n            if (page) queryString += \"&page=\".concat(page);\n            queryString += \"&per_page=\".concat(per_page); //调用搜索列表接口\n\n            _context.next = 11;\n            return api.request({\n              url: \"/search/repositories\".concat(queryString)\n            }, ctx.req, ctx.res);\n\n          case 11:\n            result = _context.sent;\n            return _context.abrupt(\"return\", {\n              repos: result.data\n            });\n\n          case 13:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function (_x) {\n    return _ref4.apply(this, arguments);\n  };\n}();\n\nexport default withRouter(Search);","map":{"version":3,"sources":["E:/个人项目/gitHub项目/coco-github/pages/search.js"],"names":["memo","isValidElement","useEffect","withRouter","Link","Router","Repo","cacheArray","api","LANGUAGE","SORT_TYPES","name","value","order","selectedItemStyle","borderLeft","fontWeight","noop","per_page","FilterLink","query","lang","sort","page","queryString","Search","router","repos","console","log","querys","items","marginBottom","item","selected","total_count","map","repo","id","Number","type","ol","p","getInitialProps","ctx","request","url","req","res","result","data"],"mappings":"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","sourcesContent":["import {memo,isValidElement,useEffect} from 'react'\r\nimport {withRouter} from 'next/router'\r\nimport {Row,Col,List,Pagination} from 'antd'  //栅格\r\nimport Link from 'next/link'\r\nimport Router from 'next/router'\r\n\r\nimport Repo from '../components/Repo'\r\nimport {cacheArray} from '../lib/repo-basic-cache'\r\n\r\nimport api from '../lib/api'\r\n\r\n//搜索条件\r\nconst LANGUAGE=['JavaScript','HTML','CSS','TypeScript','Java','Rust']\r\nconst SORT_TYPES=[\r\n  {\r\n    name:'Best Match'\r\n  },\r\n  {\r\n    name:'Most Stars',\r\n    value:'stars',\r\n    order:'desc'\r\n  },\r\n  {\r\n    name:'Fewest Stars',\r\n    value:'stars',\r\n    order:'asc'\r\n  },\r\n  {\r\n    name:'Most Forks',\r\n    value:'forks',\r\n    order:'desc'\r\n  },\r\n  {\r\n    name:'Fewest Forks',\r\n    value:'forks',\r\n    order:'asc'\r\n  },\r\n]\r\n\r\n/**\r\n * sort：排序方式\r\n * order：排序顺序（升/降序）\r\n * lang：仓库的项目开发主语言\r\n * page：分页页面\r\n */\r\n\r\n const selectedItemStyle={\r\n   borderLeft:'2px solid #e36209',\r\n   fontWeight:100\r\n }\r\n function noop(){}\r\n\r\n const per_page=20\r\n//memo方法作用：name,query,lang,sort,order 这些参数无变化，则不会被重新渲染\r\n const FilterLink=memo(({name,query,lang,sort,order,page})=>{\r\n    let queryString=`?query=${query}`\r\n    if(lang) queryString+=`&lang=${lang}`\r\n    if(sort) queryString+=`&sort=${sort}&order=${order||'desc'}`\r\n    if(page) queryString+=`&page=${page}`\r\n    queryString+=`&per_page=${per_page}`\r\n\r\n    return <Link href={`/search${queryString}`}>\r\n      {isValidElement(name)?name:<a>{name}</a>}\r\n    </Link>\r\n })\r\nfunction Search({router,repos}){\r\n  console.log(repos)\r\n  \r\n  // const {sort,order,lang,query}=router.query\r\n  const {...querys}=router.query\r\n  const {sort,order,lang,page}=router.query\r\n  //每次调用存储数据\r\n  useEffect(()=>{\r\n    cacheArray(repos.items)\r\n  })\r\n\r\n  return (\r\n    <div className=\"root\">\r\n      <Row gutter={20}>\r\n        <Col span={6}>\r\n           <List \r\n             bordered\r\n             header={<span className=\"list-header\">语言</span>}\r\n             style={{marginBottom:20}}\r\n             dataSource={LANGUAGE}\r\n             renderItem={item=>{\r\n               const selected=lang===item\r\n               return (\r\n                 <List.Item style={selected?selectedItemStyle:null}>\r\n                   {selected?<span>{item}</span>:<FilterLink {...querys} lang={item} name={item}/>}\r\n                 </List.Item>\r\n               )\r\n             }}\r\n           />\r\n            <List \r\n             bordered\r\n             header={<span className=\"list-header\">排序</span>}\r\n             dataSource={SORT_TYPES}\r\n             renderItem={item=>{\r\n               let selected=false\r\n               if(item.name==='Best Match'&&!sort){\r\n                 selected=true\r\n               }else if(item.value===sort&&item.order===order){\r\n                 selected=true\r\n               }\r\n               return (\r\n                <List.Item style={selected?selectedItemStyle:null}>\r\n                  {selected?<span>{item.name}</span>:<FilterLink {...querys} sort={item.value} order={item.order} name={item.name}/>}\r\n                 </List.Item>\r\n               )\r\n             }}\r\n           />\r\n        </Col>\r\n        <Col span={18}>\r\n            <h3 className=\"repos-title\">{repos.total_count} 个仓库</h3>\r\n            {\r\n              repos.items.map(repo => <Repo repo={repo} key={repo.id} />)\r\n            }\r\n            <div className=\"pagination\">\r\n              <Pagination\r\n                pageSize={per_page}\r\n                current={Number(page) || 1}\r\n                total={1000}\r\n                onChange={noop}\r\n                itemRender={(page, type, ol) => {\r\n                  const p =\r\n                    type === 'page' ? page : type === 'prev' ? page - 1 : page + 1\r\n                  const name = type === 'page' ? page : ol\r\n                  return <FilterLink {...querys} page={p} name={name} />\r\n                }}\r\n              />\r\n          </div>\r\n        </Col>\r\n      </Row>\r\n      <style jsx>{`\r\n        .root{\r\n          padding:20px 0;\r\n        }\r\n        .list-header{\r\n          font-weight:800;\r\n          font-size:16px;\r\n        }\r\n        .repos-title{\r\n          border-bottom:1px solid #eee;\r\n          font-size:24px;\r\n          line-height:50px;\r\n        }\r\n        .pagination{\r\n          padding:20px;\r\n          text-align:center;\r\n        }\r\n        `}</style>\r\n    </div>\r\n  )\r\n  \r\n}\r\n\r\nSearch.getInitialProps=async ({ctx})=>{\r\n  const {query,sort,order,lang,page}=ctx.query;\r\n  if(!query){\r\n    return {\r\n      repos:{\r\n        total_count:0\r\n      }\r\n    }\r\n  }\r\n  //?q=react+language:javascript&sort=stars&order=desc&page=2\r\n  let queryString=`?q=${query}`\r\n  if(lang) queryString+=`+language:${lang}`\r\n  if(sort) queryString+=`&sort=${sort}&order=${order||'desc'}`\r\n  if(page) queryString+=`&page=${page}`\r\n  queryString+=`&per_page=${per_page}`\r\n  //调用搜索列表接口\r\n  const result=await api.request({\r\n    url:`/search/repositories${queryString}`\r\n  },ctx.req,ctx.res)\r\n\r\n  return {\r\n    repos:result.data\r\n  }\r\n}\r\n\r\nexport default withRouter(Search)"]},"metadata":{},"sourceType":"module"}