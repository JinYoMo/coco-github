{"version":3,"file":"static/webpack/static\\development\\pages\\_app.js.3ff94e0db9008df70e98.hot-update.js","sources":["webpack:///./lib/with-redux.js"],"sourcesContent":["import React from 'react'\r\nimport createSore from '../store/store'\r\n\r\nconst isServer = typeof window === 'undefined' //判断是否是服务端\r\nconst __NEXT_REUDX_STORE__ = '__NEXT_REUDX_STORE__'\r\n\r\n//创建store并保存，使得在页面切换时仍是一个store基础上保存\r\nfunction getOrCreateStore(initialState) {\r\n  if (isServer) {\r\n    return createSore(initialState)\r\n  }\r\n\r\n  if (!window[__NEXT_REUDX_STORE__]) {\r\n    window[__NEXT_REUDX_STORE__] = createSore(initialState)\r\n  }\r\n  return window[__NEXT_REUDX_STORE__]\r\n}\r\nexport default (Comp)=>{\r\n  class WithReduxApp extends React.Component{\r\n    constructor(props){\r\n      super(props);  //必须填写\r\n      this.reduxStore=getOrCreateStore(props.initialReduxState)\r\n    }\r\n    render(){\r\n      const {Component,pageProps,...rest}=this.props;\r\n      console.log(Component,pageProps)\r\n      if(pageProps){\r\n        pageProps.test='123'\r\n      }\r\n      return <Comp Component={Component} pageProps={pageProps} {...rest} reduxStore={this.reduxStore}/>\r\n    }\r\n  }\r\n  //在服务端渲染的时候会被执行一次，客户端渲染也会被执行\r\n  //这个方法执行完成后会被销毁，下次执行时重新创建\r\n  WithReduxApp.getInitialProps=async(ctx)=>{\r\n      let reduxStore;\r\n      if(isServer){\r\n        const {req}=ctx.ctx;\r\n        const session=req.session;\r\n        if(session&&session.userInfo){\r\n          //作store的初始化\r\n          reduxStore = getOrCreateStore({\r\n            user:session.userInfo\r\n          });\r\n        }else{\r\n          reduxStore = getOrCreateStore();\r\n        }\r\n      }\r\n\r\n      ctx.reduxStore=reduxStore;\r\n      let appProps={};\r\n      if(typeof Comp.getInitialProps==='function'){\r\n        appProps=await Comp.getInitialProps(ctx)\r\n      }\r\n      return {\r\n        ...appProps,\r\n        initialReduxState:reduxStore.getState()\r\n      }\r\n   }\r\n   return WithReduxApp\r\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AAEA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AACA;AAAA;AACA;AADA;AACA;AAAA;AACA;AAAA;AAFA;AAGA;AACA;AANA;AAAA;AAAA;AAMA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAbA;AACA;AADA;AAAA;AAgBA;AACA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAjBA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AADA;AAkBA;AACA;AAnBA;AAAA;AAsBA;AAtBA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AAwBA;AACA;;;;A","sourceRoot":""}