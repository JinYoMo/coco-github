{"version":3,"file":"static/webpack/static\\development\\pages\\detail\\issues.js.96ad63b59e589e10cbd0.hot-update.js","sources":["webpack:///./components/SearchUser.jsx"],"sourcesContent":["import { useState, useCallback, useRef } from 'react'\r\nimport { Select, Spin } from 'antd'\r\nimport debounce from 'lodash/debounce'\r\n\r\nimport api from '../lib/api'\r\n\r\nconst Option = Select.Option\r\n\r\nfunction SearchUser ({ onChange }) {\r\n  //{current:0}\r\n  const lastFetchIdRef = useRef(0)\r\n  const [fetching, setFetching] = useState(false)\r\n  const [options, setOptions] = useState([])\r\n\r\n  //debounce 用户输入的时间超过500ms才会执行\r\n  const fetchUser = useCallback(debounce(value => {\r\n    console.log('fetching user', value)\r\n\r\n    lastFetchIdRef.current += 1\r\n    const fetchId = lastFetchIdRef.current  //每次请求id\r\n    setFetching(true)\r\n    setOptions([])  //清空数据\r\n\r\n    //服务端请求\r\n    api.request({\r\n      url: `/search/users?q=${value}`\r\n    })\r\n      .then(resp => {\r\n        console.log('user:', resp)\r\n        //在一次请求未结束 下一次请求开始时 直接将上一请求抛弃\r\n        if (fetchId !== lastFetchIdRef.current) {\r\n          return\r\n        }\r\n        const data = resp.data.items.map(user => ({\r\n          text: user.login,\r\n          value: user.login\r\n        }))\r\n\r\n        setFetching(false)\r\n        setOptions(data)\r\n      })\r\n  }, 500), [])\r\n\r\n  const handleChange = (value) => {\r\n    setOptions([])  //选择结束\r\n    setFetching(false)\r\n    onChange(value)\r\n  }\r\n\r\n  return <Select\r\n    style={{ width: 200 }}\r\n    showSearch={true}\r\n    notFoundContent={fetching ? <Spin size=\"small\" /> : <span>nothing</span>}\r\n    filterOption={false}\r\n    placeholder=\"创建者\"\r\n    onChange={handleChange}\r\n    onSearch={fetchUser}\r\n    allowClear={true}\r\n  >\r\n    {\r\n      options.map(op => (\r\n        <Option value={op.value} key={op.value}>{op.text}</Option>\r\n      ))\r\n    }\r\n  </Select>\r\n}\r\n\r\nexport default SearchUser"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAEA;AAEA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AAHA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AACA;AAKA;AACA;AAEA;AACA;AACA;AAAA;AACA;AAEA;AACA;AAAA;AACA;AADA;AAIA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAFA;AAAA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AARA;AAWA;AACA;AAAA;AAAA;AADA;AAKA;AACA;AACA;;;;A","sourceRoot":""}